<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Quantum Hypercube Game</title>
<style>
    body {
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: #d6cc98;
        font-family: sans-serif;
    }

    #container {
        position: relative;
        width: 400px;
        height: 400px;
    }

    .planet {
        position: absolute;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        font-weight: bold;
    }

    svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    line {
        stroke: #555;
        stroke-width: 4;
        cursor: pointer;
        transition: stroke 0.3s;
    }

    line:hover { stroke: #000; }

    .person {
        position: absolute;
        font-size: 3rem;
        transition: transform 0.8s ease;
    }

    #steps {
        margin-top: 15px;
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
    }

    #timer {
        margin-top: 8px;
        font-size: 1.2rem;
        color: #444;
    }

    #resetBtn {
        margin-top: 15px;
        margin-right: 5px;
        padding: 8px 16px;
        background: #7a654f;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
    }

    #resetBtn:hover {
        background: #5c4d3a;
    }

    #prevBtn, #nextBtn {
        position: absolute;
        top: 320px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        background-color: #f1f1f1b1;
        color: #7a654f;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
    }

    #prevBtn { left: 480px; }
    #nextBtn { right: 480px; }

    #prevBtn::after {
        content: "‚óÄ";
        position: relative;
        top: -1px;
        right: 3px;
        font-size: 1.5rem;
    }

    #nextBtn::after {
        content: "‚ñ∂";
        position: relative;
        top: -1px;
        left: 3px;
        font-size: 1.5rem;
    }

    #prevBtn:hover, #nextBtn:hover {
        background-color: #5c4d3a;
        color: white;
    }
</style>
</head>
<body>
<h2>Quantum Hypercube Game</h2><br>
<div id="container">
    <svg></svg>
</div>

<div id="steps">Ê≠•Êï∏Ôºö0</div>
<div id="timer">ÊôÇÈñìÔºö0 Áßí</div>
<div>
    <button id="prevBtn" class="circle-btn"></button>
    <button id="resetBtn">ÈáçÊñ∞ÈñãÂßã</button>
    <button id="nextBtn" class="circle-btn"></button>
</div>

<script>
let currentLevel = 0; // ÁõÆÂâçÈ°åÁõÆindex

// È°åÁõÆ
const levels = [
    { // ÂÖ©È°ÜÊòüÁêÉ
        planets: [
            {id: "planet1", color:"#09426a", top:140, left:20},
            {id: "planet2", color:"#9b2012", top:140, left:260}
        ],
        princes: [
            { emoji: "üê≥", target: "planet1" },
            { emoji: "üê∑", target: "planet2" }
        ],
        lines: [
            ["line12", "planet1", "planet2"]
        ]
    },
    { // ÂõõÈ°ÜÊòüÁêÉ
        planets: [
            {id: "planet1", color:"#09426a", top:0, left:0},
            {id: "planet2", color:"#9b2012", top:0, left:280},
            {id: "planet3", color:"#0b5329", top:280, left:0},
            {id: "planet4", color:"#cc9704", top:280, left:280}
        ],
        princes: [
            { emoji: "üê≥", target: "planet1" },
            { emoji: "üê∑", target: "planet2" },
            { emoji: "üê∏", target: "planet3" },
            { emoji: "üê•", target: "planet4" }
        ],
        lines: [
            ["line12", "planet1", "planet2"],
            ["line13", "planet1", "planet3"],
            ["line24", "planet2", "planet4"],
            ["line34", "planet3", "planet4"]
        ]
    }
];

let planets = {};
let princes = [];
let lines = [];
let steps = 0;
let startTime = Date.now();
let timerInterval;
const stepDisplay = document.getElementById("steps");
const timerDisplay = document.getElementById("timer");
const container = document.getElementById("container");
let svg = container.querySelector("svg");

// ÂàùÂßãÂåñÈ°åÁõÆ
function loadLevel(index){
    // Ê∏ÖÁ©∫containerÂÖßÈÉ®‰ΩÜ‰øùÁïôsvg
    container.querySelectorAll(".planet").forEach(p=>p.remove());
    svg.innerHTML = "";

    planets = {};
    princes = JSON.parse(JSON.stringify(levels[index].princes));
    lines = JSON.parse(JSON.stringify(levels[index].lines));

    // Áî¢ÁîüÊòüÁêÉ
    levels[index].planets.forEach(p=>{
        const div = document.createElement("div");
        div.classList.add("planet");
        div.id = p.id;
        div.style.background = p.color;
        div.style.top = p.top + "px";
        div.style.left = p.left + "px";
        container.appendChild(div);
        planets[p.id] = div;
    });

    // Áî¢ÁîüÁ∑ö
    lines.forEach(([id, p1, p2])=>{
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.id = id;
        line.setAttribute("x1", levels[index].planets.find(x=>x.id===p1).left + 60);
        line.setAttribute("y1", levels[index].planets.find(x=>x.id===p1).top + 60);
        line.setAttribute("x2", levels[index].planets.find(x=>x.id===p2).left + 60);
        line.setAttribute("y2", levels[index].planets.find(x=>x.id===p2).top + 60);
        line.style.stroke="#555";
        line.style.strokeWidth="4";
        line.style.cursor="pointer";
        svg.appendChild(line);

        line.addEventListener("click", ()=> swap(p1,p2));
    });

    steps = 0;
    stepDisplay.textContent = `Ê≠•Êï∏Ôºö0`;
    placePrincesRandomly();
    startTimer();
}

// Èö®Ê©üÊîæÁΩÆ‰∫∫Áâ©
function shuffle(array){return array.sort(()=>Math.random()-0.5);}
function placePrincesRandomly(){
    const keys = Object.keys(planets);
    const shuffledPlanets = shuffle([...keys]);
    Object.values(planets).forEach(p=>p.innerHTML="");
    princes.forEach((prince,i)=>{
        const pDiv = document.createElement("div");
        pDiv.classList.add("person");
        pDiv.textContent = prince.emoji;
        planets[shuffledPlanets[i]].appendChild(pDiv);
    });
}

// ÈªûÊìäÁ∑öÊ¢ù‰∫§Êèõ
function swap(p1,p2){
    const personA = planets[p1].querySelector(".person");
    const personB = planets[p2].querySelector(".person");
    if(!personA || !personB) return;
    steps++;
    stepDisplay.textContent = `Ê≠•Êï∏Ôºö${steps}`;

    const rectA = planets[p1].getBoundingClientRect();
    const rectB = planets[p2].getBoundingClientRect();
    const deltaX = rectB.left - rectA.left;
    const deltaY = rectB.top - rectA.top;

    personA.style.transform = `translate(${deltaX}px,${deltaY}px)`;
    personB.style.transform = `translate(${-deltaX}px,${-deltaY}px)`;

    setTimeout(()=>{
        planets[p1].appendChild(personB);
        planets[p2].appendChild(personA);
        personA.style.transform="";
        personB.style.transform="";
        checkSuccess();
    },800);
}

// Ê™¢Êü•ÊòØÂê¶ÂÆåÊàê
function checkSuccess(){
    const success = princes.every(prince=>{
        const planet = planets[prince.target];
        const person = planet.querySelector(".person");
        return person && person.textContent===prince.emoji;
    });
    if(success){
        const seconds = Math.floor((Date.now()-startTime)/1000);
        clearInterval(timerInterval);
        alert(`ÂìáÔºÅ‰Ω†Ëµ∞‰∫Ü ${steps} Ê≠•ÔºåËä±‰∫Ü ${seconds} ÁßíÔºåËÆìÊØèÂÄãÂãïÁâ©ÈÉΩÂõûÂà∞Â∞çÊáâ„ÑâÊòüÁêÉ‰∏äËÄ∂~\nBtw ‰Ω†Ë™™ÈÄôÊòØÂ∞èÁéãÂ≠êÈÇÑÊòØÂãïÁâ©ÊòüÁêÉÂë¢Ôºü`);
    }
}

// Ë®àÊôÇÂô®
function startTimer(){
    clearInterval(timerInterval);
    startTime=Date.now();
    timerInterval=setInterval(()=>{
        const seconds = Math.floor((Date.now()-startTime)/1000);
        timerDisplay.textContent = `ÊôÇÈñìÔºö${seconds} Áßí`;
    },1000);
}

// ÈáçÊñ∞ÈñãÂßã
document.getElementById("resetBtn").addEventListener("click",()=>{
    steps=0;
    stepDisplay.textContent=`Ê≠•Êï∏Ôºö0`;
    placePrincesRandomly();
    startTimer();
});

// Â∑¶Âè≥ÂàáÊèõÈ°åÁõÆ
document.getElementById("nextBtn").addEventListener("click", ()=>{
    currentLevel = (currentLevel + 1) % levels.length;
    loadLevel(currentLevel);
});
document.getElementById("prevBtn").addEventListener("click", ()=>{
    currentLevel = (currentLevel - 1 + levels.length) % levels.length;
    loadLevel(currentLevel);
});

// ÂàùÂßãÂåñ
loadLevel(currentLevel);

</script>
</body>
</html>
