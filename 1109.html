<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Quantum Hypercube Game</title>
<style>
    body {
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: #d6cc98;
        font-family: sans-serif;
        overflow: hidden;
    }

    #container {
        position: relative;
        width: 400px;
        height: 400px;
        overflow: hidden;
    }

    .planet {
        position: absolute;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        font-weight: bold;
    }

    svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    line {
        stroke: #555;
        stroke-width: 5;
        cursor: pointer;
        transition: stroke 0.3s;
    }

    line:hover { stroke: #000; }

    .person {
        position: absolute;
        font-size: 3rem;
        transition: transform 0.8s ease;
    }

    #steps {
        margin-top: 15px;
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
    }

    #timer {
        margin-top: 8px;
        font-size: 1.2rem;
        color: #444;
    }

    #resetBtn {
        margin-top: 15px;
        margin-right: 5px;
        padding: 8px 16px;
        background: #7a654f;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
    }

    #resetBtn:hover {
        background: #5c4d3a;
    }

    #prevBtn, #nextBtn {
        position: absolute;
        top: 320px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: none;
        background-color: #f1f1f1b1;
        color: #7a654f;
        font-size: 1.5rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
        z-index: 50;
    }

    #prevBtn { left: 5%; }
    #nextBtn { right: 5%; }

    #prevBtn::after {
        content: "â—€";
        position: relative;
        top: -1px;
        right: 3px;
        font-size: 1.5rem;
    }

    #nextBtn::after {
        content: "â–¶";
        position: relative;
        top: -1px;
        left: 3px;
        font-size: 1.5rem;
    }

    #prevBtn:hover, #nextBtn:hover {
        background-color: #5c4d3a;
        color: white;
    }

    /* å¤§è¢å¹• */
    #prevBtn { left: calc(50% - 320px); }
    #nextBtn { left: calc(50% + 270px); }
    /* å°è¢å¹• */
    @media (max-width: 768px) {
        #prevBtn {
            left: 5%;
            top: 350px;
        }
        #nextBtn {
            right: 5%;
            top: 350px;
            left: auto;
        }
    }

    /* å‹•ç•«é¡åˆ¥ï¼ˆä½¿ç”¨æ–¼ containerï¼‰ */
    .slide-out-left { animation: slideOutLeft 0.6s forwards; }
    .slide-in-right { animation: slideInRight 0.6s forwards; }
    .slide-out-right { animation: slideOutRight 0.6s forwards; }
    .slide-in-left { animation: slideInLeft 0.6s forwards; }

    @keyframes slideOutLeft {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(-100%); opacity: 0; }
    }
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
    @keyframes slideInLeft {
        from { transform: translateX(-100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    .popup {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.4);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.3s ease;
    }

    .popup-content {
        background: white;
        border-radius: 20px;
        padding: 30px 40px;
        text-align: center;
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        animation: popUp 0.4s ease;
    }

    .popup-content h2 {
        margin: 8 0 10px;
    }

    .popup-content button {
        background: #ffb60b;
        color: white;
        border: none;
        border-radius: 12px;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 16px;
        transition: background 0.2s;
    }

    .popup-content button:hover {
        background: #ff750b;
    }

    @keyframes fadeIn {
        from {opacity: 0;}
        to {opacity: 1;}
    }

    @keyframes popUp {
        from {transform: scale(0.8); opacity: 0;}
        to {transform: scale(1); opacity: 1;}
    }
</style>
</head>
<body>
<h2>Quantum Hypercube Game</h2><br>
<div id="container">
    <svg></svg>
</div>

<div id="steps">æ­¥æ•¸ï¼š0</div>
<div id="timer">æ™‚é–“ï¼š0 ç§’</div>
<div>
    <button id="prevBtn" class="circle-btn"></button>
    <button id="resetBtn">é‡æ–°é–‹å§‹</button>
    <button id="nextBtn" class="circle-btn"></button>
</div>

<div id="successPopup" class="popup">
  <div class="popup-content">
    <h2>ğŸ‰ æˆåŠŸï¼</h2>
    <p></p><br>
    <button id="closePopup">å†ç©ä¸€æ¬¡</button>
  </div>
</div>

<script>
let currentLevel = 0; // ç›®å‰é¡Œç›®ï¼ˆä¸€é–‹å§‹é¡¯ç¤ºç¬¬0é¡Œï¼‰
const levels = [
    { // å…©é¡†æ˜Ÿçƒ
        planets: [
            {id: "planet1", color:"#09426a", top:140, left:20},
            {id: "planet2", color:"#9b2012", top:140, left:260}
        ],
        princes: [
            { emoji: "ğŸ³", target: "planet1" },
            { emoji: "ğŸ·", target: "planet2" }
        ],
        lines: [["line12", "planet1", "planet2"]]
    },
    { // å››é¡†æ˜Ÿçƒ
        planets: [
            {id: "planet1", color:"#09426a", top:0, left:0},
            {id: "planet2", color:"#9b2012", top:0, left:280},
            {id: "planet3", color:"#0b5329", top:280, left:0},
            {id: "planet4", color:"#cc9704", top:280, left:280}
        ],
        princes: [
            { emoji: "ğŸ³", target: "planet1" },
            { emoji: "ğŸ·", target: "planet2" },
            { emoji: "ğŸ¸", target: "planet3" },
            { emoji: "ğŸ¥", target: "planet4" }
        ],
        lines: [
            ["line12", "planet1", "planet2"],
            ["line13", "planet1", "planet3"],
            ["line24", "planet2", "planet4"],
            ["line34", "planet3", "planet4"]
        ]
    }
];

let planets = {};
let princes = [];
let steps = 0;
let startTime = Date.now();
let timerInterval;

const stepDisplay = document.getElementById("steps");
const timerDisplay = document.getElementById("timer");
const container = document.getElementById("container");
let svg = container.querySelector("svg");

function loadLevel(index){
    // æ¸…ç©ºèˆŠçš„æ˜Ÿçƒèˆ‡ç·š
    container.querySelectorAll(".planet").forEach(p=>p.remove());
    container.querySelectorAll("line").forEach(l=>l.remove());
    svg = container.querySelector("svg");
    svg.innerHTML = "";

    planets = {};
    princes = JSON.parse(JSON.stringify(levels[index].princes));
    const levelLines = JSON.parse(JSON.stringify(levels[index].lines));

    // å»ºç«‹æ˜Ÿçƒ
    levels[index].planets.forEach(p=>{
        const div = document.createElement("div");
        div.classList.add("planet");
        div.id = p.id;
        div.style.background = p.color;
        div.style.top = p.top + "px";
        div.style.left = p.left + "px";
        container.appendChild(div);
        planets[p.id] = div;
    });

    // å»ºç«‹ç·šï¼ˆåŠ å…¥åˆ° svgï¼‰
    levelLines.forEach(([id, p1, p2])=>{
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.id = id;
        line.setAttribute("x1", levels[index].planets.find(x=>x.id===p1).left + 60);
        line.setAttribute("y1", levels[index].planets.find(x=>x.id===p1).top + 60);
        line.setAttribute("x2", levels[index].planets.find(x=>x.id===p2).left + 60);
        line.setAttribute("y2", levels[index].planets.find(x=>x.id===p2).top + 60);
        line.style.stroke = "#555";
        line.style.strokeWidth = 4;
        line.style.cursor = "pointer";
        line.style.transition = "stroke 0.3s";
        svg.appendChild(line);

        line.addEventListener("mouseenter", () => line.style.stroke = "#000");
        line.addEventListener("mouseleave", () => line.style.stroke = "#555");

        line.addEventListener("click", ()=> swap(p1, p2));
    });


    steps = 0;
    stepDisplay.textContent = `æ­¥æ•¸ï¼š0`;

    placePrincesRandomly();
    startTimer();
}

function shuffle(array){ return array.sort(()=>Math.random()-0.5); }

function placePrincesRandomly(){
    const keys = Object.keys(planets);
    let shuffled;
    do {
        shuffled = shuffle([...keys]);
    } while (shuffled.every((key, i) => key === princes[i].target)); 
    // å¦‚æœæ¯å€‹å‹•ç‰©éƒ½åœ¨æ­£ç¢ºä½ç½®ï¼Œå°±å†æ´—ä¸€æ¬¡

    Object.values(planets).forEach(p=> p.innerHTML = "");
    princes.forEach((prince,i)=>{
        const d = document.createElement("div");
        d.className = "person";
        d.textContent = prince.emoji;
        planets[shuffled[i]].appendChild(d);
    });
}

function swap(p1, p2){
    const personA = planets[p1].querySelector(".person");
    const personB = planets[p2].querySelector(".person");
    if(!personA || !personB) return;
    steps++;
    stepDisplay.textContent = `æ­¥æ•¸ï¼š${steps}`;

    const rectA = planets[p1].getBoundingClientRect();
    const rectB = planets[p2].getBoundingClientRect();
    const deltaX = rectB.left - rectA.left;
    const deltaY = rectB.top - rectA.top;

    personA.style.transform = `translate(${deltaX}px,${deltaY}px)`;
    personB.style.transform = `translate(${-deltaX}px,${-deltaY}px)`;

    setTimeout(()=>{
        planets[p1].appendChild(personB);
        planets[p2].appendChild(personA);
        personA.style.transform = "";
        personB.style.transform = "";
        checkSuccess();
    }, 800);
}

function checkSuccess(){
    const ok = princes.every(prince=>{
        const person = planets[prince.target].querySelector(".person");
        return person && person.textContent === prince.emoji;
    });
    if(ok){
        const seconds = Math.floor((Date.now()-startTime)/1000);
        clearInterval(timerInterval);
        showPopup(steps, seconds); 

    }
}

function startTimer(){
    clearInterval(timerInterval);
    startTime = Date.now();
    timerInterval = setInterval(()=>{
        const seconds = Math.floor((Date.now()-startTime)/1000);
        timerDisplay.textContent = `æ™‚é–“ï¼š${seconds} ç§’`;
    },1000);
}

function showPopup(steps, seconds) {
    const popup = document.getElementById("successPopup");
    const message = `å“‡ï¼ä½ èµ°äº† ${steps} æ­¥ï¼ŒèŠ±äº† ${seconds} ç§’ï¼Œè®“æ¯å€‹å‹•ç‰©éƒ½å›åˆ°å°æ‡‰ã„‰æ˜Ÿçƒä¸Šè€¶~<br>Btw ä½ èªªé€™æ˜¯å°ç‹å­é‚„æ˜¯å‹•ç‰©æ˜Ÿçƒå‘¢ï¼Ÿ`;
    popup.querySelector("p").innerHTML = message; // ç”¨ innerHTML ä»£æ›¿ textContent
    popup.style.display = "flex";
}

document.getElementById("closePopup").addEventListener("click", () => {
  document.getElementById("successPopup").style.display = "none";
  placePrincesRandomly(); // é‡æ–°æ´—ç‰Œé–‹å§‹æ–°éŠæˆ²
});

// é‡æ–°é–‹å§‹
document.getElementById("resetBtn").addEventListener("click", ()=>{
    steps = 0;
    stepDisplay.textContent = `æ­¥æ•¸ï¼š0`;
    placePrincesRandomly();
    startTimer();
});

// åˆ‡æ›å‹•ç•«ï¼ˆæŒ‰å·¦æˆ–æŒ‰å³ï¼‰
let animating = false;
function transitionLevel(nextIndex, direction){
    if(animating) return;
    animating = true;

    // å…ˆå¥—ä¸ŠèˆŠç•«é¢çš„æ»‘å‡º class
    if(direction === "left") container.classList.add("slide-out-left");
    else container.classList.add("slide-out-right");

    // ç­‰èˆŠç•«é¢æ»‘å‡ºä¸€åŠå†è¼‰å…¥æ–°ç•«é¢
    setTimeout(()=>{
        loadLevel(nextIndex); // æ–°é¡Œç›®
        container.classList.remove("slide-out-left","slide-out-right"); // ç§»é™¤èˆŠçš„slide-out class

        // æ–°ç•«é¢åšæ»‘å…¥å‹•ç•«
        if(direction === "left") container.classList.add("slide-in-right");
        else container.classList.add("slide-in-left");

        // å‹•ç•«çµæŸå¾Œæ¸…é™¤classä¸¦å…è¨±ä¸‹ä¸€æ¬¡åˆ‡æ›
        setTimeout(()=>{
            container.classList.remove("slide-in-right","slide-in-left");
            animating = false;
        }, 620);
    }, 320); // å…ˆè®“èˆŠç•«é¢é–‹å§‹æ»‘å‹•
}

// å·¦å³æŒ‰éˆ•ç¶å®š
document.getElementById("prevBtn").addEventListener("click", ()=>{
    const next = (currentLevel - 1 + levels.length) % levels.length;
    transitionLevel(next, "left");
    currentLevel = next;
});
document.getElementById("nextBtn").addEventListener("click", ()=>{
    const next = (currentLevel + 1) % levels.length;
    transitionLevel(next, "right");
    currentLevel = next;
});

// åˆå§‹è¼‰å…¥ç¬¬0é¡Œ
loadLevel(0);
</script>
</body>
</html>
